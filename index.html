<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BTC 关机币价计算器</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>₿</text></svg>">
  <style>
    :root {
      --bg: #1a1a2e;
      --card: #16213e;
      --border: #0f3460;
      --text: #eaeaea;
      --dim: #a0a0a0;
      --gold: #f7931a;
      --green: #00d26a;
      --red: #ff4757;
      --blue: #4da6ff;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    
    /* Header Stats */
    .stats-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 24px;
      padding: 20px;
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    .stat-item {
      flex: 1;
      min-width: 150px;
    }
    .stat-label {
      font-size: 12px;
      color: var(--dim);
      margin-bottom: 4px;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
    }
    .stat-value.price { color: var(--gold); }
    .stat-value.hashrate { color: var(--blue); }
    .stat-value.range { font-size: 16px; }
    .stat-value .profit { color: var(--green); }
    .stat-value .loss { color: var(--red); }
    
    /* Electricity Slider */
    .elec-control {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      margin-bottom: 24px;
    }
    .elec-label { font-size: 14px; color: var(--dim); }
    .elec-slider {
      flex: 1;
      max-width: 300px;
      height: 6px;
      -webkit-appearance: none;
      background: linear-gradient(90deg, var(--green), var(--gold), var(--red));
      border-radius: 3px;
      outline: none;
    }
    .elec-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .elec-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--gold);
      min-width: 100px;
    }
    
    /* Chart Container */
    .chart-section {
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 20px;
      margin-bottom: 24px;
    }
    .chart-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    .chart-wrapper {
      position: relative;
      height: 300px;
      overflow-x: auto;
    }
    .chart {
      display: flex;
      align-items: flex-end;
      height: 250px;
      gap: 4px;
      min-width: max-content;
      padding: 0 10px;
    }
    .bar-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 24px;
    }
    .bar {
      width: 20px;
      border-radius: 3px 3px 0 0;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }
    .bar.profit { background: linear-gradient(180deg, #00d26a, #00a854); }
    .bar.loss { background: linear-gradient(180deg, #ff4757, #c0392b); }
    .bar:hover { opacity: 0.8; transform: scaleX(1.1); }
    .bar-label {
      font-size: 9px;
      color: var(--dim);
      writing-mode: vertical-rl;
      text-orientation: mixed;
      transform: rotate(180deg);
      margin-top: 8px;
      max-height: 80px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .price-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--gold);
      z-index: 10;
    }
    .price-line::after {
      content: attr(data-price);
      position: absolute;
      right: 100%;
      top: -10px;
      background: var(--gold);
      color: #000;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
      margin-right: 5px;
    }
    .y-axis {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 50px;
      width: 60px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      font-size: 10px;
      color: var(--dim);
      text-align: right;
      padding-right: 8px;
    }
    
    /* Table */
    .table-section {
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .table-title {
      font-size: 16px;
      font-weight: 600;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }
    .miner-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .miner-table th {
      text-align: left;
      padding: 12px 16px;
      color: var(--dim);
      font-weight: 500;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.2);
    }
    .miner-table td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }
    .miner-table tr:hover { background: rgba(255,255,255,0.02); }
    .miner-table .model { font-weight: 500; }
    .miner-table .shutdown { font-weight: 600; }
    .miner-table .shutdown.profit { color: var(--green); }
    .miner-table .shutdown.loss { color: var(--red); }
    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }
    .status-profit { background: rgba(0,210,106,0.15); color: var(--green); }
    .status-loss { background: rgba(255,71,87,0.15); color: var(--red); }
    
    .footer {
      text-align: center;
      padding: 20px;
      font-size: 12px;
      color: var(--dim);
    }
    .footer a { color: var(--blue); text-decoration: none; }
    
    @media (max-width: 768px) {
      .stats-bar { gap: 12px; padding: 16px; }
      .stat-value { font-size: 18px; }
      .stat-item { min-width: 120px; }
      .miner-table { font-size: 11px; }
      .miner-table th, .miner-table td { padding: 8px 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-label">BTC 价格</div>
        <div class="stat-value price" id="btc-price">$--,---</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">全网算力</div>
        <div class="stat-value hashrate" id="hashrate">--- EH/s</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">关机价范围</div>
        <div class="stat-value range" id="range">$--- - $---</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">盈利矿机</div>
        <div class="stat-value" id="profit-count"><span class="profit">--</span>/<span class="loss">--</span></div>
      </div>
    </div>
    
    <div class="elec-control">
      <span class="elec-label">电费单价:</span>
      <input type="range" class="elec-slider" id="electricity" min="0.02" max="0.15" step="0.01" value="0.06">
      <span class="elec-value" id="elec-value">$0.06/kWh</span>
    </div>
    
    <div class="chart-section">
      <div class="chart-title">矿机关机币价分布</div>
      <div class="chart-wrapper">
        <div class="chart" id="chart"></div>
        <div class="price-line" id="price-line" data-price=""></div>
      </div>
    </div>
    
    <div class="table-section">
      <div class="table-title">矿机详情</div>
      <table class="miner-table">
        <thead>
          <tr>
            <th>矿机型号</th>
            <th>算力</th>
            <th>功耗</th>
            <th>功耗比</th>
            <th>关机价</th>
            <th>状态</th>
          </tr>
        </thead>
        <tbody id="miner-tbody"></tbody>
      </table>
    </div>
    
    <div class="footer">
      <p>数据来源: Binance · blockchain.info | Built by <a href="https://x.fish">Fish</a></p>
    </div>
  </div>
  
  <script>
    const BLOCK_REWARD = 3.125;
    
    // 矿机数据 (型号, 算力TH/s, 功耗W)
    const MINERS = [
      { model: 'Antminer S23 Hyd', hashrate: 380, power: 5428 },
      { model: 'Whatsminer M66S', hashrate: 298, power: 5007 },
      { model: 'Antminer S21 Hyd', hashrate: 335, power: 5360 },
      { model: 'Whatsminer M63S', hashrate: 390, power: 7215 },
      { model: 'Antminer S21 Pro', hashrate: 234, power: 3510 },
      { model: 'Antminer S21', hashrate: 200, power: 3500 },
      { model: 'Whatsminer M60S', hashrate: 186, power: 3422 },
      { model: 'Antminer T21', hashrate: 190, power: 3610 },
      { model: 'Antminer S19 XP Hyd', hashrate: 255, power: 5304 },
      { model: 'Antminer S19 XP', hashrate: 140, power: 3010 },
      { model: 'Whatsminer M50S++', hashrate: 150, power: 3276 },
      { model: 'Whatsminer M50S+', hashrate: 140, power: 3080 },
      { model: 'Avalon A1466', hashrate: 150, power: 3350 },
      { model: 'Antminer S19j Pro+', hashrate: 122, power: 3355 },
      { model: 'Antminer S19 Pro', hashrate: 110, power: 3250 },
      { model: 'Whatsminer M30S++', hashrate: 112, power: 3472 },
      { model: 'Whatsminer M30S+', hashrate: 100, power: 3400 },
      { model: 'Antminer S19j Pro', hashrate: 104, power: 3068 },
      { model: 'Antminer S19', hashrate: 95, power: 3250 },
      { model: 'Whatsminer M30S', hashrate: 86, power: 3268 },
      { model: 'Avalon A1246', hashrate: 90, power: 3420 },
      { model: 'Antminer S17+', hashrate: 73, power: 2920 },
      { model: 'Antminer T17+', hashrate: 64, power: 3200 },
      { model: 'Whatsminer M20S', hashrate: 68, power: 3360 },
    ];
    
    let currentPrice = 0;
    let currentDifficulty = 0;
    
    function calcShutdownPrice(hashrate, power, difficulty, elecPrice) {
      const btcPerDay = (86400 * hashrate * 1e12 * BLOCK_REWARD) / (difficulty * Math.pow(2, 32));
      const elecCostPerDay = power * 24 / 1000 * elecPrice;
      return elecCostPerDay / btcPerDay;
    }
    
    function calcNetworkHashrate(difficulty) {
      return (difficulty * Math.pow(2, 32) / 600 / 1e18).toFixed(1);
    }
    
    async function fetchData() {
      try {
        const [tickerRes, diffRes] = await Promise.all([
          fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT'),
          fetch('https://blockchain.info/q/getdifficulty')
        ]);
        currentPrice = parseFloat((await tickerRes.json()).price);
        currentDifficulty = parseFloat(await diffRes.text());
        
        document.getElementById('btc-price').textContent = '$' + currentPrice.toLocaleString('en-US', {maximumFractionDigits: 0});
        document.getElementById('hashrate').textContent = calcNetworkHashrate(currentDifficulty) + ' EH/s';
        
        updateAll();
      } catch (e) { console.error('数据获取失败:', e); }
    }
    
    function updateAll() {
      const elecPrice = parseFloat(document.getElementById('electricity').value);
      const chartEl = document.getElementById('chart');
      const tbodyEl = document.getElementById('miner-tbody');
      
      // 计算所有关机价
      const minerData = MINERS.map(m => ({
        ...m,
        efficiency: (m.power / m.hashrate).toFixed(1),
        shutdownPrice: calcShutdownPrice(m.hashrate, m.power, currentDifficulty, elecPrice)
      })).sort((a, b) => a.shutdownPrice - b.shutdownPrice);
      
      const minPrice = Math.min(...minerData.map(m => m.shutdownPrice));
      const maxPrice = Math.max(...minerData.map(m => m.shutdownPrice));
      const profitCount = minerData.filter(m => currentPrice > m.shutdownPrice).length;
      
      // 更新统计
      document.getElementById('range').textContent = 
        '$' + Math.round(minPrice).toLocaleString() + ' - $' + Math.round(maxPrice).toLocaleString();
      document.getElementById('profit-count').innerHTML = 
        `<span class="profit">${profitCount}</span>/<span class="loss">${minerData.length}</span>`;
      
      // 绘制图表
      const chartHeight = 250;
      const maxChartPrice = maxPrice * 1.2;
      
      chartEl.innerHTML = minerData.map(m => {
        const height = (m.shutdownPrice / maxChartPrice) * chartHeight;
        const isProfit = currentPrice > m.shutdownPrice;
        return `
          <div class="bar-group">
            <div class="bar ${isProfit ? 'profit' : 'loss'}" 
                 style="height: ${height}px" 
                 title="${m.model}: $${Math.round(m.shutdownPrice).toLocaleString()}">
            </div>
            <div class="bar-label">${m.model.replace('Antminer ', '').replace('Whatsminer ', '')}</div>
          </div>
        `;
      }).join('');
      
      // 价格线位置
      const priceLine = document.getElementById('price-line');
      const linePos = chartHeight - (currentPrice / maxChartPrice) * chartHeight;
      priceLine.style.top = Math.max(0, Math.min(chartHeight, linePos)) + 'px';
      priceLine.setAttribute('data-price', '$' + currentPrice.toLocaleString('en-US', {maximumFractionDigits: 0}));
      
      // 更新表格
      tbodyEl.innerHTML = minerData.map(m => {
        const isProfit = currentPrice > m.shutdownPrice;
        return `<tr>
          <td class="model">${m.model}</td>
          <td>${m.hashrate} TH/s</td>
          <td>${m.power} W</td>
          <td>${m.efficiency} W/TH</td>
          <td class="shutdown ${isProfit ? 'profit' : 'loss'}">$${Math.round(m.shutdownPrice).toLocaleString()}</td>
          <td><span class="status-badge ${isProfit ? 'status-profit' : 'status-loss'}">${isProfit ? '盈利' : '亏损'}</span></td>
        </tr>`;
      }).join('');
    }
    
    document.getElementById('electricity').addEventListener('input', function() {
      document.getElementById('elec-value').textContent = '$' + this.value + '/kWh';
      if (currentPrice > 0 && currentDifficulty > 0) updateAll();
    });
    
    fetchData();
    setInterval(fetchData, 30000);
  </script>
</body>
</html>
