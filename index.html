<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BTC Dashboard | æ¯”ç‰¹å¸ä»ªè¡¨ç›˜</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â‚¿</text></svg>">
  <style>
    :root {
      --bg: #0d1117;
      --card: #161b22;
      --card-hover: #1c2128;
      --border: #30363d;
      --text: #e6edf3;
      --dim: #7d8590;
      --gold: #f7931a;
      --cyan: #58a6ff;
      --green: #3fb950;
      --red: #f85149;
      --purple: #a371f7;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 1rem;
      line-height: 1.5;
    }
    .container { max-width: 900px; margin: 0 auto; }
    
    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .logo {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--gold), #ff9500);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .header-text h1 { font-size: 1.25rem; font-weight: 600; }
    .header-text p { font-size: 0.8rem; color: var(--dim); }
    
    .price-hero {
      background: linear-gradient(135deg, rgba(247,147,26,0.15), rgba(88,166,255,0.1));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    .price-label { font-size: 0.75rem; color: var(--dim); text-transform: uppercase; letter-spacing: 1px; }
    .price-value {
      font-size: 3rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--gold), var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0.25rem 0;
    }
    .price-change {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .price-change.up { background: rgba(63,185,80,0.15); color: var(--green); }
    .price-change.down { background: rgba(248,81,73,0.15); color: var(--red); }
    
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1rem; }
    
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.2s;
    }
    .card:hover { background: var(--card-hover); border-color: var(--dim); }
    .card-icon { font-size: 1.25rem; margin-bottom: 0.5rem; }
    .card-label { font-size: 0.7rem; color: var(--dim); text-transform: uppercase; letter-spacing: 0.5px; }
    .card-value { font-size: 1.5rem; font-weight: 600; margin: 0.25rem 0; }
    .card-sub { font-size: 0.75rem; color: var(--dim); }
    .card-badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 500;
      margin-top: 0.5rem;
    }
    .badge-buy { background: rgba(63,185,80,0.15); color: var(--green); }
    .badge-hold { background: rgba(247,147,26,0.15); color: var(--gold); }
    .badge-sell { background: rgba(248,81,73,0.15); color: var(--red); }
    
    .halving-card { grid-column: span 2; background: linear-gradient(135deg, var(--card), rgba(247,147,26,0.05)); }
    .countdown { display: flex; gap: 0.5rem; margin-top: 0.75rem; }
    .countdown-item { flex: 1; text-align: center; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 8px; }
    .countdown-num { font-size: 1.25rem; font-weight: 700; color: var(--gold); }
    .countdown-unit { font-size: 0.65rem; color: var(--dim); }
    
    .shutdown-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .shutdown-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .shutdown-title { font-size: 0.9rem; font-weight: 600; }
    .shutdown-meta { font-size: 0.7rem; color: var(--dim); }
    .electricity-control { display: flex; align-items: center; gap: 0.5rem; font-size: 0.75rem; color: var(--dim); }
    .electricity-slider {
      width: 100px;
      height: 4px;
      -webkit-appearance: none;
      background: var(--border);
      border-radius: 2px;
      outline: none;
    }
    .electricity-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: var(--gold);
      border-radius: 50%;
      cursor: pointer;
    }
    .electricity-value { min-width: 60px; text-align: right; color: var(--gold); font-weight: 500; }
    
    .miner-table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; font-size: 0.8rem; }
    .miner-table th { text-align: left; padding: 0.5rem; color: var(--dim); font-weight: 500; border-bottom: 1px solid var(--border); }
    .miner-table td { padding: 0.5rem; border-bottom: 1px solid var(--border); }
    .miner-table tr:hover { background: rgba(255,255,255,0.02); }
    .miner-table .model { font-weight: 500; }
    .miner-table .shutdown-price { font-weight: 600; }
    .miner-table .shutdown-price.safe { color: var(--green); }
    .miner-table .shutdown-price.warning { color: var(--gold); }
    .miner-table .shutdown-price.danger { color: var(--red); }
    .miner-table .status { font-size: 0.7rem; padding: 0.15rem 0.4rem; border-radius: 4px; }
    .status-profit { background: rgba(63,185,80,0.15); color: var(--green); }
    .status-marginal { background: rgba(247,147,26,0.15); color: var(--gold); }
    .status-loss { background: rgba(248,81,73,0.15); color: var(--red); }
    
    .shutdown-visual { position: relative; height: 40px; background: linear-gradient(90deg, var(--red), var(--gold), var(--green)); border-radius: 8px; margin-bottom: 0.5rem; }
    .shutdown-marker {
      position: absolute;
      top: -8px;
      transform: translateX(-50%);
      width: 3px;
      height: 56px;
      background: white;
      border-radius: 2px;
    }
    .shutdown-marker::after {
      content: attr(data-label);
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.65rem;
      white-space: nowrap;
      color: white;
      font-weight: 500;
    }
    .shutdown-status { text-align: center; font-size: 0.8rem; color: var(--dim); }
    
    .footer {
      text-align: center;
      padding: 1rem 0;
      font-size: 0.7rem;
      color: var(--dim);
      border-top: 1px solid var(--border);
    }
    .footer a { color: var(--cyan); text-decoration: none; }
    
    @media (max-width: 480px) {
      .price-value { font-size: 2.25rem; }
      .card-value { font-size: 1.25rem; }
      .grid { gap: 0.5rem; }
      .card { padding: 0.75rem; }
      .countdown-num { font-size: 1rem; }
      .electricity-slider { width: 80px; }
      .miner-table { font-size: 0.7rem; }
      .miner-table th, .miner-table td { padding: 0.35rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">â‚¿</div>
      <div class="header-text">
        <h1>Bitcoin Dashboard</h1>
        <p>å®æ—¶ä»·æ ¼ Â· ahr999 Â· å…³æœºå¸ä»· Â· å‡åŠå€’è®¡æ—¶</p>
      </div>
    </div>
    
    <div class="price-hero">
      <div class="price-label">BTC / USDT</div>
      <div class="price-value" id="price">$--,---</div>
      <div class="price-change up" id="change">
        <span id="change-icon">â†‘</span>
        <span id="change-text">--%</span>
      </div>
    </div>
    
    <div class="grid">
      <div class="card">
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-label">ahr999 æŒ‡æ•°</div>
        <div class="card-value" id="ahr999">--</div>
        <div class="card-sub" id="ahr999-desc">åŠ è½½ä¸­...</div>
        <div class="card-badge badge-hold" id="ahr999-badge">--</div>
      </div>
      
      <div class="card">
        <div class="card-icon">â›ï¸</div>
        <div class="card-label">ç½‘ç»œéš¾åº¦</div>
        <div class="card-value" id="difficulty">--</div>
        <div class="card-sub" id="diff-change">--</div>
      </div>
      
      <div class="card halving-card">
        <div class="card-icon">â°</div>
        <div class="card-label">ä¸‹æ¬¡å‡åŠå€’è®¡æ—¶</div>
        <div class="card-value" id="halving-date">2028å¹´4æœˆ</div>
        <div class="countdown">
          <div class="countdown-item">
            <div class="countdown-num" id="days">---</div>
            <div class="countdown-unit">å¤©</div>
          </div>
          <div class="countdown-item">
            <div class="countdown-num" id="hours">--</div>
            <div class="countdown-unit">æ—¶</div>
          </div>
          <div class="countdown-item">
            <div class="countdown-num" id="mins">--</div>
            <div class="countdown-unit">åˆ†</div>
          </div>
          <div class="countdown-item">
            <div class="countdown-num" id="secs">--</div>
            <div class="countdown-unit">ç§’</div>
          </div>
        </div>
        <div class="card-sub" style="margin-top:0.5rem">åŒºå—å¥–åŠ±: 3.125 â†’ 1.5625 BTC</div>
      </div>
    </div>
    
    <div class="shutdown-section">
      <div class="shutdown-header">
        <div>
          <div class="shutdown-title">â›ï¸ çŸ¿å·¥å…³æœºå¸ä»· (åŠ¨æ€è®¡ç®—)</div>
          <div class="shutdown-meta">åŸºäºå®æ—¶éš¾åº¦ + çŸ¿æœºåŠŸè€—æ¯”</div>
        </div>
        <div class="electricity-control">
          <span>ç”µè´¹:</span>
          <input type="range" class="electricity-slider" id="electricity" min="0.03" max="0.12" step="0.01" value="0.06">
          <span class="electricity-value" id="elec-value">$0.06/kWh</span>
        </div>
      </div>
      
      <table class="miner-table">
        <thead>
          <tr>
            <th>çŸ¿æœºå‹å·</th>
            <th>ç®—åŠ›</th>
            <th>åŠŸè€—æ¯”</th>
            <th>å…³æœºä»·</th>
            <th>çŠ¶æ€</th>
          </tr>
        </thead>
        <tbody id="miner-tbody"></tbody>
      </table>
      
      <div class="shutdown-visual" id="shutdown-visual">
        <div class="shutdown-marker" id="price-marker" data-label="å½“å‰ä»·æ ¼"></div>
      </div>
      <div class="shutdown-status" id="shutdown-status">åŠ è½½ä¸­...</div>
    </div>
    
    <div class="footer">
      <p>æ•°æ®æ¥æº: Binance Â· blockchain.info | æ›´æ–°: <span id="update-time">--</span></p>
      <p>Built with â¤ï¸ by <a href="https://x.fish">Fish</a> Â· <a href="https://github.com/bitfish3/btc-dashboard">GitHub</a></p>
    </div>
  </div>
  
  <script>
    const HALVING_DATE = new Date('2028-04-17T00:00:00Z');
    const BLOCK_REWARD = 3.125;
    
    // çŸ¿æœºæ•°æ®: å‹å·, ç®—åŠ›(TH/s), åŠŸè€—(W), åŠŸè€—æ¯”(W/TH)
    const MINERS = [
      { model: 'Antminer S21 Hyd', hashrate: 335, power: 5360, efficiency: 16.0 },
      { model: 'Antminer S21 Pro', hashrate: 234, power: 3510, efficiency: 15.0 },
      { model: 'Antminer S21', hashrate: 200, power: 3500, efficiency: 17.5 },
      { model: 'Whatsminer M60S', hashrate: 186, power: 3422, efficiency: 18.4 },
      { model: 'Antminer S19 XP Hyd', hashrate: 255, power: 5304, efficiency: 20.8 },
      { model: 'Antminer S19 XP', hashrate: 140, power: 3010, efficiency: 21.5 },
      { model: 'Whatsminer M50S++', hashrate: 150, power: 3276, efficiency: 21.8 },
      { model: 'Antminer S19j Pro+', hashrate: 122, power: 3355, efficiency: 27.5 },
      { model: 'Antminer S19 Pro', hashrate: 110, power: 3250, efficiency: 29.5 },
      { model: 'Whatsminer M30S++', hashrate: 112, power: 3472, efficiency: 31.0 },
    ];
    
    let currentPrice = 0;
    let currentDifficulty = 0;
    
    // è®¡ç®—å…³æœºä»·æ ¼
    // å…¬å¼: å…³æœºä»· = æ—¥ç”µè´¹/TH Ã· æ—¥äº§BTC/TH
    // æ—¥äº§BTC/TH = (86400s Ã— 1e12H Ã— åŒºå—å¥–åŠ±) / (éš¾åº¦ Ã— 2^32)
    // æ—¥ç”µè´¹/TH = åŠŸè€—æ¯”(W/TH) Ã— 24h / 1000 Ã— ç”µä»·($/kWh)
    function calcShutdownPrice(efficiency, difficulty, elecPrice) {
      // æ¯THæ¯å¤©äº§å‡ºBTC (1 TH/s = 1e12 H/s)
      const btcPerThPerDay = (86400 * 1e12 * BLOCK_REWARD) / (difficulty * Math.pow(2, 32));
      // æ¯THæ¯å¤©ç”µè´¹
      const elecCostPerThPerDay = efficiency * 24 / 1000 * elecPrice;
      // å…³æœºä»· = ç”µè´¹ / äº§å‡º
      return elecCostPerThPerDay / btcPerThPerDay;
    }
    
    async function fetchPrice() {
      try {
        const tickerRes = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
        const ticker = await tickerRes.json();
        currentPrice = parseFloat(ticker.lastPrice);
        const change24h = parseFloat(ticker.priceChangePercent);
        
        document.getElementById('price').textContent = '$' + currentPrice.toLocaleString('en-US', {maximumFractionDigits: 0});
        
        const changeEl = document.getElementById('change');
        document.getElementById('change-icon').textContent = change24h >= 0 ? 'â†‘' : 'â†“';
        document.getElementById('change-text').textContent = Math.abs(change24h).toFixed(2) + '% (24h)';
        changeEl.className = 'price-change ' + (change24h >= 0 ? 'up' : 'down');
        
        updateAhr999(currentPrice);
        if (currentDifficulty > 0) updateMiners();
        document.getElementById('update-time').textContent = new Date().toLocaleTimeString('zh-CN');
      } catch (e) { console.error('ä»·æ ¼è·å–å¤±è´¥:', e); }
    }
    
    async function fetchDifficulty() {
      try {
        const res = await fetch('https://blockchain.info/q/getdifficulty');
        currentDifficulty = parseFloat(await res.text());
        const diffT = (currentDifficulty / 1e12).toFixed(2);
        document.getElementById('difficulty').textContent = diffT + ' T';
        document.getElementById('diff-change').textContent = 'ç½‘ç»œç®—åŠ› ~' + (currentDifficulty * Math.pow(2, 32) / 600 / 1e18).toFixed(0) + ' EH/s';
        if (currentPrice > 0) updateMiners();
      } catch (e) { console.error('éš¾åº¦è·å–å¤±è´¥:', e); }
    }
    
    function updateAhr999(price) {
      const daysFromGenesis = Math.floor((Date.now() - new Date('2009-01-03').getTime()) / 86400000);
      const expectedLogPrice = 5.84 * Math.log10(daysFromGenesis) - 17.01;
      const expectedPrice = Math.pow(10, expectedLogPrice);
      const dcaCost = price * 0.92;
      const ahr999 = (price / dcaCost) * (price / expectedPrice);
      
      document.getElementById('ahr999').textContent = ahr999.toFixed(2);
      
      let desc, badge, badgeClass;
      if (ahr999 < 0.45) { desc = 'ğŸŸ¢ æŠ„åº•åŒºé—´'; badge = 'å®šæŠ•+æŠ„åº•'; badgeClass = 'badge-buy'; }
      else if (ahr999 < 1.2) { desc = 'ğŸŸ¢ å®šæŠ•åŒºé—´'; badge = 'åšæŒå®šæŠ•'; badgeClass = 'badge-buy'; }
      else if (ahr999 < 5) { desc = 'ğŸŸ¡ è§‚æœ›åŒºé—´'; badge = 'æŒæœ‰è§‚æœ›'; badgeClass = 'badge-hold'; }
      else { desc = 'ğŸ”´ æ³¡æ²«åŒºé—´'; badge = 'é€æ­¥æ­¢ç›ˆ'; badgeClass = 'badge-sell'; }
      
      document.getElementById('ahr999-desc').textContent = desc;
      const badgeEl = document.getElementById('ahr999-badge');
      badgeEl.textContent = badge;
      badgeEl.className = 'card-badge ' + badgeClass;
    }
    
    function updateMiners() {
      const elec = parseFloat(document.getElementById('electricity').value);
      const tbody = document.getElementById('miner-tbody');
      tbody.innerHTML = '';
      
      let shutdownPrices = [];
      
      MINERS.forEach(m => {
        const shutdownPrice = calcShutdownPrice(m.efficiency, currentDifficulty, elec);
        shutdownPrices.push(shutdownPrice);
        
        let priceClass, statusClass, statusText;
        if (currentPrice > shutdownPrice * 1.5) {
          priceClass = 'safe'; statusClass = 'status-profit'; statusText = 'ç›ˆåˆ©';
        } else if (currentPrice > shutdownPrice) {
          priceClass = 'warning'; statusClass = 'status-marginal'; statusText = 'å¾®åˆ©';
        } else {
          priceClass = 'danger'; statusClass = 'status-loss'; statusText = 'äºæŸ';
        }
        
        tbody.innerHTML += `<tr>
          <td class="model">${m.model}</td>
          <td>${m.hashrate} TH/s</td>
          <td>${m.efficiency} W/TH</td>
          <td class="shutdown-price ${priceClass}">$${Math.round(shutdownPrice).toLocaleString()}</td>
          <td><span class="status ${statusClass}">${statusText}</span></td>
        </tr>`;
      });
      
      // æ›´æ–°å¯è§†åŒ–
      const minShutdown = Math.min(...shutdownPrices);
      const maxShutdown = Math.max(...shutdownPrices);
      const range = maxShutdown * 1.3 - minShutdown * 0.7;
      const position = Math.min(100, Math.max(0, ((currentPrice - minShutdown * 0.7) / range) * 100));
      
      const marker = document.getElementById('price-marker');
      marker.style.left = position + '%';
      marker.setAttribute('data-label', '$' + currentPrice.toLocaleString());
      
      const profitCount = shutdownPrices.filter(p => currentPrice > p).length;
      const pct = Math.round(profitCount / MINERS.length * 100);
      document.getElementById('shutdown-status').textContent = 
        `å½“å‰ä»·æ ¼é«˜äº ${profitCount}/${MINERS.length} æ¬¾çŸ¿æœºå…³æœºä»· (${pct}% çŸ¿æœºç›ˆåˆ©)`;
    }
    
    function updateCountdown() {
      const diff = HALVING_DATE - Date.now();
      if (diff <= 0) return;
      document.getElementById('days').textContent = Math.floor(diff / 86400000);
      document.getElementById('hours').textContent = String(Math.floor((diff % 86400000) / 3600000)).padStart(2, '0');
      document.getElementById('mins').textContent = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
      document.getElementById('secs').textContent = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
    }
    
    document.getElementById('electricity').addEventListener('input', function() {
      document.getElementById('elec-value').textContent = '$' + this.value + '/kWh';
      if (currentPrice > 0 && currentDifficulty > 0) updateMiners();
    });
    
    fetchPrice();
    fetchDifficulty();
    updateCountdown();
    
    setInterval(fetchPrice, 10000);
    setInterval(fetchDifficulty, 300000); // 5åˆ†é’Ÿæ›´æ–°éš¾åº¦
    setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
